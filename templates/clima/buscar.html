{% extends "clima/base.html" %}
{% block title %}Buscar ciudad · Clima{% endblock %}

{% block content %}
<div class="text-center mb-5">
  <h1 class="fw-bold text-primary mb-3">Buscá una ciudad</h1>
  <p class="text-muted">Ingresá el nombre de una ciudad para conocer su pronóstico</p>
</div>

<!-- formulario de búsqueda -->
<form id="cityForm" class="row justify-content-center g-2 mb-4" method="get" novalidate>
  <div class="col-sm-6 col-md-4">
    <input id="cityInput" class="form-control form-control-lg" type="search" name="q" placeholder="Ej: Buenos Aires" value="{{ q }}">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary btn-lg">Buscar</button>
    <a class="btn btn-outline-secondary btn-lg" href="/">Limpiar</a>
  </div>
</form>

<!-- contenedor para mostrar el mensaje -->
<div id="alertContainer" class="d-flex justify-content-center mb-4"></div>

{% if q and not resultados %}
  <div class="text-center text-muted">
    <p>No se encontraron resultados para <strong>{{ q }}</strong>.</p>
  </div>
{% endif %}

{% if resultados %}
  <h4 class="mb-3 text-center text-secondary">Resultados</h4>
  <div class="list-group shadow-sm">
    {% for r in resultados %}
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
         href="{% url 'pronostico' %}?lat={{ r.latitude|stringformat:'.6f' }}&lon={{ r.longitude|stringformat:'.6f' }}&nombre={{ r.name }}{% if r.admin1 %}, {{ r.admin1 }}{% endif %}{% if r.country %}, {{ r.country }}{% endif %}">
        <div>
          <div class="fw-semibold">{{ r.name }}{% if r.admin1 %} ({{ r.admin1 }}){% endif %}</div>
          <small class="text-muted">{{ r.country }} — lat: {{ r.latitude }}, lon: {{ r.longitude }}</small>
        </div>
        <span class="badge bg-primary">Ver</span>
      </a>
    {% endfor %}
  </div>
{% endif %}

<!-- validación -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("cityForm");
  const input = document.getElementById("cityInput");
  const alertContainer = document.getElementById("alertContainer");

  form.addEventListener("submit", function (e) {
    // Limpia cualquier alerta anterior
    alertContainer.innerHTML = "";

    // Si el campo está vacío
    if (input.value.trim() === "") {
      e.preventDefault(); // Detiene el envío del formulario

      // Crea un mensaje de alerta Bootstrap
      const alert = document.createElement("div");
      alert.className = "alert alert-warning alert-dismissible fade show shadow-sm w-50";
      alert.role = "alert";
      alert.innerHTML = `
        ⚠️ Por favor, ingresá el nombre de una ciudad antes de buscar.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      alertContainer.appendChild(alert);

      // Enfoca el input
      input.focus();

      // Hace que el mensaje desaparezca automáticamente después de 3 segundos
      setTimeout(() => {
        const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
        bsAlert.close();
      }, 3000);
    }
  });
});
</script>
{% endblock %}
